"use strict";function empty(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function init(){ws=new WebSocket("ws:/"+window.location.hostname+"/ws"),ws.onmessage=processMessage,ws.onclose=reconnect}function reconnect(){console.error("WebSocket getrennt. Erneut verbinden in 2 s..."),clearTimeout(ws.timeout),ws.timeout=setTimeout(init,2e3)}function processMessage(e){try{let t=JSON.parse(e.data),n=[void 0,gotStatus,gotLog,void 0,settingResponse,gotParameter,gotPv,gotCommandList,gotSettingList,gotParameterList,gotPvList];n[t[0]](t[1])}catch(e){console.error(e)}displayConnectivity()}function displayConnectivity(){if("undefined"==displayConnectivity.locked&&(displayConnectivity.locked=!1),displayConnectivity.locked)return;displayConnectivity.locked=!0,setTimeout(function(){displayConnectivity.locked=!1},100);let e=$("#ws")[0],t={"-":"\\","\\":"|","|":"/","/":"-"};e.innerHTML=t[e.innerHTML]}function gotStatus(e){ws.send("[1,1]")}function gotLog(e){let t=$("[name=logFilter]")[0].value;if(!e.includes(t))return;let n=$("#log")[0],i=e.charAt(0),o=document.createElement("pre");o.innerHTML=e;let l={E:"red",W:"orange",I:"green",D:"black",V:"gray"};o.style.color=l[i],n.prepend(o)}function gotParameter(e){console.log(e)}function gotCommandList(e){let t=$("#commands")[0];empty(t);for(let n of e){let e=document.createElement("fieldset");e.name=n[0],e.innerHTML="<legend>"+n[0]+"</legend>";for(let t of n[1])e.innerHTML+="<input type='button' value='"+t+"' name='"+t+"'> ";t.appendChild(e)}t.addEventListener("click",commandClick,!0)}function commandClick(e){let t=e.target,n=t.parentNode,i=$("fieldset",t.form).indexOf(n),o=$("input",n).indexOf(t);ws.send("[3,["+i+","+o+"]]")}function gotSettingList(e){let t=$("#settings")[0];empty(t);for(let n of e){let e=document.createElement("fieldset");e.name=n[0],e.innerHTML="<legend>"+n[0]+"</legend>";for(let t of n[1])e.innerHTML+="<input type='number' name='"+t+"'> ",e.innerHTML+="<label for='"+t+"'>"+t+"</label><br>";t.appendChild(e)}$("input",t).forEach(settingRequest),t.addEventListener("blur",settingBlur,!0)}function settingRequest(e){let t=e.parentNode,n=$("fieldset",e.form).indexOf(t),i=$("input",t).indexOf(e);ws.send("[4,["+n+","+i+"]]")}function settingResponse(e){let t=$("#settings")[0],n=$("fieldset",t)[e[0]],i=$("input",n)[e[1]];i.setAttribute("qType",e[2]),i.value=e[3]}function settingBlur(e){let t=e.target,n=t.parentNode,i=$("fieldset",t.form).indexOf(n),o=$("input",n).indexOf(t),l=t.value;if(t.attributes.qType){switch(parseInt(t.attributes.qtype.value)){case 1:l<0&&(l=0);case 2:l=Math.round(l);case 3:break;default:return}ws.send("[4,["+i+","+o+","+t.value+"]]")}}function gotParameterList(e){gotCommandList(e)}function gotPvList(e){let t=$("#pvs")[0];empty(t);for(let n of e){let e=document.createElement("fieldset");e.name=n[0],e.innerHTML="<legend>"+n[0]+"</legend>";for(let t of n[1])e.innerHTML+="<input type='button' value='Registrieren' name='"+t+"'> ",e.innerHTML+="<label for='"+t+"'>"+t+"</label><br>";t.appendChild(e)}for(let e of $("input",t))e.addEventListener("click",pvRegister)}function pvRegister(e){let t=e.target,n=t.parentNode,i=$("fieldset",t.form).indexOf(n),o=$("input",n).indexOf(t);t.value=0,t.type="number",ws.send("[6,["+i+","+o+"]]")}function gotPv(e){let t=$("#pvs")[0],n=$("fieldset",t)[e[0]],i=$("input",n)[e[1]];i.value=e[3],i.dispatchEvent(new Event("change"))}function clearLog(){empty($("#log")[0])}NodeList.prototype.indexOf=Array.prototype.indexOf;let ws,$=(e,t=document)=>t.querySelectorAll(e);window.onload=init;