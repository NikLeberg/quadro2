"use strict";function empty(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function init(){ws=new WebSocket("ws:/"+window.location.hostname+"/ws"),ws.onmessage=processMessage,ws.onclose=reconnect}function reconnect(){console.error("WebSocket getrennt. Erneut verbinden in 2 s..."),clearTimeout(ws.timeout),ws.timeout=setTimeout(init,2e3)}function processMessage(e){try{let t=JSON.parse(e.data),n=[void 0,gotStatus,gotLog,void 0,settingResponse,parameterResponse,gotPv,gotCommandList,gotSettingList,gotParameterList,gotPvList];n[t[0]](t[1])}catch(e){console.error(e)}displayConnectivity()}function displayConnectivity(){if("undefined"==displayConnectivity.locked&&(displayConnectivity.locked=!1),displayConnectivity.locked)return;displayConnectivity.locked=!0,setTimeout(function(){displayConnectivity.locked=!1},100);let e=$("#ws")[0],t={"-":"\\","\\":"|","|":"/","/":"-"};e.innerHTML=t[e.innerHTML]}function gotStatus(e){ws.send("[1,1]")}function gotLog(e){let t=$("[name=logFilter]")[0].value;if(!e.includes(t))return;let n=$("#log")[0],i=e.charAt(0),o=document.createElement("pre");o.innerHTML=e;let r={E:"red",W:"orange",I:"green",D:"black",V:"gray"};o.style.color=r[i],n.prepend(o)}function genericCreateForm(e,t,n,i,o){empty(t);for(let r of e){let e=document.createElement("fieldset");e.name=r[0],e.innerHTML="<legend>"+r[0]+"</legend>";for(let t of r[1])e.innerHTML+="<input type='"+n+"' name='"+t+"' value='"+(i||t)+"'> ",o&&(e.innerHTML+="<label for='"+t+"'>"+t+"</label><br>");t.appendChild(e)}}function gotCommandList(e){let t=$("#commands")[0];genericCreateForm(e,t,"button",void 0,!1),t.addEventListener("click",commandClick,!0)}function commandClick(e){let t=e.target,n=t.parentNode,i=$("fieldset",t.form).indexOf(n),o=$("input",n).indexOf(t);ws.send("[3,["+i+","+o+"]]")}function gotSettingList(e){let t=$("#settings")[0];genericCreateForm(e,t,"number","0",!0),$("input",t).forEach(valueRequest),t.addEventListener("blur",valueBlur,!0)}function settingResponse(e){let t=$("#settings")[0],n=$("fieldset",t)[e[0]],i=$("input",n)[e[1]];i.setAttribute("qType",e[2]),i.value=e[3]}function gotParameterList(e){let t=$("#parameters")[0];genericCreateForm(e,t,"number","0",!0),$("input",t).forEach(valueRequest),t.addEventListener("blur",valueBlur,!0)}function parameterResponse(e){let t=$("#parameters")[0],n=$("fieldset",t)[e[0]],i=$("input",n)[e[1]];i.setAttribute("qType",e[2]),i.value=e[3]}function valueRequest(e){let t=e.parentNode,n=$("fieldset",e.form).indexOf(t),i=$("input",t).indexOf(e);ws.send("["+("settings"==e.form.id?4:5)+",["+n+","+i+"]]")}function valueBlur(e){let t=e.target,n=t.parentNode,i=$("fieldset",t.form).indexOf(n),o=$("input",n).indexOf(t),r=t.value;if(t.attributes.qType){switch(parseInt(t.attributes.qtype.value)){case 1:r<0&&(r=0);case 2:r=Math.round(r);case 3:break;default:return}ws.send("["+("settings"==t.form.id?4:5)+",["+i+","+o+","+t.value+"]]")}}function gotPvList(e){let t=$("#pvs")[0];genericCreateForm(e,t,"button","Registrieren",!0);for(let e of $("input",t))e.addEventListener("click",pvRegister)}function pvRegister(e){let t=e.target,n=t.parentNode,i=$("fieldset",t.form).indexOf(n),o=$("input",n).indexOf(t);t.value=0,t.type="number",ws.send("[6,["+i+","+o+"]]")}function gotPv(e){let t=$("#pvs")[0],n=$("fieldset",t)[e[0]],i=$("input",n)[e[1]];0==e[2]?(i.type="text",i.value=(new Date).toLocaleTimeString()):i.value=e[3],i.dispatchEvent(new Event("change"))}function clearLog(){empty($("#log")[0])}NodeList.prototype.indexOf=Array.prototype.indexOf;let ws,$=(e,t=document)=>t.querySelectorAll(e);window.addEventListener("load",function(e){init();for(let e of $("#intercom > p"))e.addEventListener("click",function(e){let t=e.target.nextSibling.style;"none"==t.display?t.display="inherit":t.display="none"})});